\section{File access}
The vulnerabilities related to file access arise when an application improperly manages file operations, allowing unauthorized users to read, write, or execute files on the server.
In the following sections, we are going to analyze the most common vulnerabilities related to file access.
\subsection{File Inclusion}
File inclusion vulnerabilities can affect applications that rely on run-time tasks that work with files (i.e. when an application allows users to access files, submit input into files, upload files to the server).
We can distinguish two main types of file inclusion vulnerabilities:
\begin{itemize}
    \item \textbf{Local File Inclusion (LFI)}: occurs when an application uses the path to a local file as input. It aims at forcing the application to expose or run files on the server;
    \item \textbf{Remote File Inclusion (RFI)}: occurs when an application dynamically references external resources, such as files or scripts. It aims at exploiting the referencing function to upload a malware from a remote URL.
\end{itemize}

\subsection{File Access - Directory Traversal}
\label{Dir-Traversal}
A path traversal (directory traversal) attack aims to access files and directories that are stored outside the web server's document root. 
If the web server is misconfigured, an attacker may be able to modify the path in the URL (for example, using sequences like ``\texttt{../}'' )
to access files the application did not intend to expose.
\\\\For example, an attacker could try to access sensitive files by manipulating the URL as follows:
\begin{lstlisting}[language=php, caption=Example of Directory Traversal Attack]
<?php
$template = 'blue.php';
if (isset($_COOKIE['TEMPLATE']))
    $template = $_COOKIE['TEMPLATE'];

include("/home/users/phpguru/templates/" . $template);
?>
\end{lstlisting}
In this example, the application includes a template file based on the value of the \texttt{TEMPLATE} cookie.
 An attacker could set the cookie to a value like ``\texttt{../../../../etc/passwd}'' to attempt to access the system's password file.

 \subsection{Filename-based Binding}
Often, file names are used to bind a file to a program object. However, every time a file name is referenced in an operation, this binding is reasserted â€” meaning that the program may end up operating on a different file if the file name has been changed or replaced in the meantime.  
Therefore, checks are required to ensure that the intended file is actually being accessed.  
\\\\It is recommended to access files using file descriptors rather than just file names, as they provide a higher degree of certainty about which file object is actually being acted upon.

\subsection{TOCTOU (Time Of Check, Time Of Use)}
\textit{Time Of Check, Time Of Use} (TOCTOU) is a race condition that occurs when an application performs:
\begin{itemize}
    \item a check operation, to verify the existence or state of a file at time $t$;
    \item a use operation, to read or write data at a later time $t + \Delta t$.
\end{itemize}
If another process modifies or deletes the file between the check and the use, the application may operate on an unintended or invalid file, leading to race conditions or security vulnerabilities.
\\\\A more effective solution involves using atomic operations and accessing files via file descriptors, which ensures that the file being operated on is the same one that was originally opened.

\subsection{Mitigation}
To mitigate file access vulnerabilities, consider the following best practices:
\begin{itemize}
    \item Avoid the use of user inputs within the file system calls;
    \item If forced to use user input for file operations, resolve and validate the paths. 
    Always validate and sanitize user inputs to prevent directory traversal attacks;
    \item Use file descriptors, rather than filenames.
\end{itemize}